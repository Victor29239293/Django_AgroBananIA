{% extends 'components/base.html' %} 
{% block title %}BanaIA - Login & Registro{% endblock %} 
{% block extra_head %} 
{% endblock %} 
{% block content %}
<div class="login-page">
  <div class="login-container">
    <!-- Side Panel -->
    <div class="side-panel">
    </div>

    <!-- Form Panel -->
    <div class="form-panel">
      <!-- Display Messages -->
      {% if messages %}
      <div class="messages-container">
        {% for message in messages %}
        <div class="alert alert-{{ message.tags }}">
          <i class="fas fa-{% if message.tags == 'error' %}exclamation-circle{% elif message.tags == 'success' %}check-circle{% else %}info-circle{% endif %}"></i>
          {{ message }}
        </div>
        {% endfor %}
      </div>
      {% endif %}

      <!-- Toggle Buttons -->
      <div class="toggle-btns">
        <button class="toggle-btn {% if not show_register %}active{% endif %}" onclick="showForm('login')">
          Iniciar Sesión
        </button>
        <button class="toggle-btn {% if show_register %}active{% endif %}" onclick="showForm('register')">
          Registrarse
        </button>
      </div>

      <!-- Login Form -->
      <div id="loginForm" class="form-container {% if not show_register %}active{% endif %}">
        <div class="form-header">
          <h3>¡Bienvenido de nuevo!</h3>
          <p>Ingresa tus credenciales para continuar</p>
        </div>

        <form method="post" action="{% url 'security:login' %}">
          {% csrf_token %}
          <input type="hidden" name="login_submit" value="1">

          <div class="form-group">
            <label for="{{ login_form.username.id_for_label }}">Usuario o Correo Electrónico</label>
            <div class="input-wrapper">
              <i class="fas fa-envelope"></i>
              {{ login_form.username }}
            </div>
            {% if login_form.username.errors %}
              <span class="error-text">{{ login_form.username.errors.0 }}</span>
            {% endif %}
          </div>

          <div class="form-group">
            <label for="{{ login_form.password.id_for_label }}">Contraseña</label>
            <div class="input-wrapper">
              <i class="fas fa-lock"></i>
              {{ login_form.password }}
              <span class="password-toggle" onclick="togglePassword('{{ login_form.password.id_for_label }}')">
                <i class="fas fa-eye"></i>
              </span>
            </div>
            {% if login_form.password.errors %}
              <span class="error-text">{{ login_form.password.errors.0 }}</span>
            {% endif %}
          </div>

          <div class="form-options">
            <div class="checkbox-wrapper">
              <input type="checkbox" id="rememberMe" name="remember_me" />
              <label for="rememberMe">Recordarme</label>
            </div>
            <a href="" class="forgot-password">¿Olvidaste tu contraseña?</a>
          </div>

          <button type="submit" class="btn btn-primary">
            <i class="fas fa-sign-in-alt"></i> Iniciar Sesión
          </button>
        </form>

        <div class="divider">
          <span>o continúa con</span>
        </div>

        <div class="social-login">
          <button class="btn-social btn-google" onclick="alert('Funcionalidad de Google OAuth próximamente')">
            <i class="fab fa-google"></i>
            Google
          </button>
          <button class="btn-social btn-facebook" onclick="alert('Funcionalidad de Facebook OAuth próximamente')">
            <i class="fab fa-facebook-f"></i>
            Facebook
          </button>
        </div>

        <div class="form-footer">
          ¿No tienes una cuenta?
          <a href="#" onclick="showForm('register'); return false;">Regístrate aquí</a>
        </div>
      </div>

      <!-- Register Form -->
      <div id="registerForm" class="form-container {% if show_register %}active{% endif %}">
        <div class="form-header">
          <h3>Crear una cuenta</h3>
          <p>Únete a la revolución agrícola digital</p>
        </div>

        <form method="post" action="{% url 'security:login' %}">
          {% csrf_token %}
          <input type="hidden" name="register_submit" value="1">

          <div class="form-row">
            <div class="form-col">
              <div class="form-group">
                <label for="{{ register_form.first_name.id_for_label }}">Nombre</label>
                <div class="input-wrapper">
                  <i class="fas fa-user"></i>
                  {{ register_form.first_name }}
                </div>
                {% if register_form.first_name.errors %}
                  <span class="error-text">{{ register_form.first_name.errors.0 }}</span>
                {% endif %}
              </div>
            </div>

            <div class="form-col">
              <div class="form-group">
                <label for="{{ register_form.last_name.id_for_label }}">Apellido</label>
                <div class="input-wrapper">
                  <i class="fas fa-user"></i>
                  {{ register_form.last_name }}
                </div>
                {% if register_form.last_name.errors %}
                  <span class="error-text">{{ register_form.last_name.errors.0 }}</span>
                {% endif %}
              </div>
            </div>
          </div>

          <div class="form-group">
            <label for="{{ register_form.username.id_for_label }}">Nombre de Usuario</label>
            <div class="input-wrapper">
              <i class="fas fa-user-circle"></i>
              {{ register_form.username }}
            </div>
            {% if register_form.username.errors %}
              <span class="error-text">{{ register_form.username.errors.0 }}</span>
            {% endif %}
          </div>

          <div class="form-group">
            <label for="{{ register_form.email.id_for_label }}">Correo Electrónico</label>
            <div class="input-wrapper">
              <i class="fas fa-envelope"></i>
              {{ register_form.email }}
            </div>
            {% if register_form.email.errors %}
              <span class="error-text">{{ register_form.email.errors.0 }}</span>
            {% endif %}
          </div>

          <div class="form-row">
            <div class="form-col">
              <div class="form-group">
                <label for="{{ register_form.password1.id_for_label }}">Contraseña</label>
                <div class="input-wrapper">
                  <i class="fas fa-lock"></i>
                  {{ register_form.password1 }}
                </div>
                {% if register_form.password1.errors %}
                  <span class="error-text">{{ register_form.password1.errors.0 }}</span>
                {% endif %}
              </div>
            </div>

            <div class="form-col">
              <div class="form-group">
                <label for="{{ register_form.password2.id_for_label }}">Confirmar Contraseña</label>
                <div class="input-wrapper">
                  <i class="fas fa-lock"></i>
                  {{ register_form.password2 }}
                </div>
                {% if register_form.password2.errors %}
                  <span class="error-text">{{ register_form.password2.errors.0 }}</span>
                {% endif %}
              </div>
            </div>
          </div>

          <div class="form-options">
            <div class="checkbox-wrapper">
              <input type="checkbox" id="acceptTerms" name="accept_terms" required />
              <label for="acceptTerms">Acepto los términos y condiciones</label>
            </div>
          </div>

          <button type="submit" class="btn btn-primary">
            <i class="fas fa-user-plus"></i> Crear Cuenta
          </button>
        </form>

        <div class="divider">
          <span>o regístrate con</span>
        </div>

        <div class="social-login">
          <button class="btn-social btn-google" onclick="alert('Funcionalidad de Google OAuth próximamente')">
            <i class="fab fa-google"></i>
            Google
          </button>
          <button class="btn-social btn-facebook" onclick="alert('Funcionalidad de Facebook OAuth próximamente')">
            <i class="fab fa-facebook-f"></i>
            Facebook
          </button>
        </div>

        <div class="form-footer">
          ¿Ya tienes una cuenta?
          <a href="#" onclick="showForm('login'); return false;">Inicia sesión aquí</a>
        </div>
      </div>
    </div>
  </div>

  <script>
    function showForm(formType) {
      const loginForm = document.getElementById("loginForm");
      const registerForm = document.getElementById("registerForm");
      const toggleBtns = document.querySelectorAll(".toggle-btn");

      if (formType === "login") {
        loginForm.classList.add("active");
        registerForm.classList.remove("active");
        toggleBtns[0].classList.add("active");
        toggleBtns[1].classList.remove("active");
      } else {
        registerForm.classList.add("active");
        loginForm.classList.remove("active");
        toggleBtns[1].classList.add("active");
        toggleBtns[0].classList.remove("active");
      }
    }

    function togglePassword(inputId) {
      const input = document.getElementById(inputId);
      const icon = input.parentElement.querySelector(".password-toggle i");

      if (input.type === "password") {
        input.type = "text";
        icon.classList.remove("fa-eye");
        icon.classList.add("fa-eye-slash");
      } else {
        input.type = "password";
        icon.classList.remove("fa-eye-slash");
        icon.classList.add("fa-eye");
      }
    }
  </script>
</div>

<style>
  /* Estilos para mensajes */
  .messages-container {
    margin-bottom: 20px;
  }

  .alert {
    padding: 12px 15px;
    border-radius: 8px;
    margin-bottom: 10px;
    display: flex;
    align-items: center;
    gap: 10px;
    animation: slideIn 0.3s ease-out;
  }

  @keyframes slideIn {
    from {
      transform: translateY(-10px);
      opacity: 0;
    }
    to {
      transform: translateY(0);
      opacity: 1;
    }
  }

  .alert-success {
    background-color: #d4edda;
    color: #155724;
    border: 1px solid #c3e6cb;
  }

  .alert-error {
    background-color: #f8d7da;
    color: #721c24;
    border: 1px solid #f5c6cb;
  }

  .alert-warning {
    background-color: #fff3cd;
    color: #856404;
    border: 1px solid #ffeaa7;
  }

  .alert-info {
    background-color: #d1ecf1;
    color: #0c5460;
    border: 1px solid #bee5eb;
  }

  .error-text {
    color: #dc3545;
    font-size: 0.875rem;
    display: block;
    margin-top: 5px;
  }

  .form-control {
    width: 100%;
    padding: 10px 15px 10px 45px;
    border: 1px solid #e0e0e0;
    border-radius: 8px;
    font-size: 14px;
    transition: border-color 0.3s;
  }

  .form-control:focus {
    outline: none;
    border-color: #4CAF50;
  }

  .input-wrapper {
    position: relative;
  }

  .input-wrapper i.fas {
    position: absolute;
    left: 15px;
    top: 50%;
    transform: translateY(-50%);
    color: #666;
  }
</style>
{% endblock %}
